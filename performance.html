<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å ‚Äî SyncOra</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet"/>
  <link href="style.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body data-page="performance">
<header class="site-header">
  <div class="nav">
    <div class="logo"><a href="index.html"><img src="images/logo.png" alt="SyncOra Logo"/></a></div>
    <div class="menu-toggle" aria-label="Toggle menu"><span></span><span></span><span></span></div>
    <nav class="navigation">
      <ul>
        <li><a href="index.html">–ì–æ–ª–æ–≤–Ω–∞</a></li>
        <li><a href="tasks.html">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è</a></li>
        <li><a href="communication.html">–ö–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è</a></li>
        <li><a class="active" href="performance.html">–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</a></li>
        <li><a href="motivation.html">–ú–æ—Ç–∏–≤–∞—Ü—ñ—è</a></li>
      </ul>
    </nav>
    <div class="controls">
      <button class="lang-toggle" id="lang-toggle">–£–∫—Ä</button>
      <a class="auth-btn" href="login.html" id="userAction">–£–≤—ñ–π—Ç–∏</a>
    </div>
  </div>
</header>

<section class="page-header" style="background:linear-gradient(to right, #0077ff, #00c853);color:white;">
  <div class="page-title">
    <h1>–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</h1>
    <p>–û—Ü—ñ–Ω—é–π—Ç–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ä–æ–±–æ—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ —á–µ—Ä–µ–∑ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ –¥–∞–Ω—ñ.</p>
  </div>
</section>

<main class="report-block">
  <section class="report-summary" data-aos="fade-up">
    <h2>–í–∞—à—ñ –∑–≤—ñ—Ç–∏</h2>
    <div id="reportsContainer" class="challenge-list"></div>
    <div style="text-align:center;margin-top:24px;">
      <button class="btn-large" onclick="generateReport()">‚ûï –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑–≤—ñ—Ç</button>
      <button class="btn-large" onclick="exportData('json')">‚¨áÔ∏è JSON</button>
      <button class="btn-large" onclick="exportData('csv')">‚¨áÔ∏è CSV</button>
    </div>
  </section>

  <section style="max-width:900px;margin:60px auto;">
    <h2 style="text-align:center;">–ê–Ω–∞–ª—ñ—Ç–∏—á–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫</h2>
    <canvas id="reportChart" height="200"></canvas>
  </section>

  <section style="text-align:center;">
    <button class="btn-large" onclick="downloadReportPDF()">üìÑ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ PDF</button>
  </section>

<section class="features" style="max-width:1000px;margin:60px auto;display:flex;flex-wrap:wrap;gap:20px;justify-content:center;">
  <div style="flex:1;min-width:280px;background:#fff;padding:20px;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,0.05);">
    <h3>–ü—Ä–æ–≥—Ä–µ—Å –∫–æ–º–∞–Ω–¥–∏</h3>
    <p>–°–ª—ñ–¥–∫—É–π—Ç–µ –∑–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—é –Ω–∞ —Ä—ñ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ —Ç–∞ –æ–∫—Ä–µ–º–∏—Ö —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤.</p>
  </div>
  <div style="flex:1;min-width:280px;background:#fff;padding:20px;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,0.05);">
    <h3>–î–∏–Ω–∞–º—ñ–∫–∞ –∑–≤—ñ—Ç—ñ–≤</h3>
    <p>–ê–Ω–∞–ª—ñ–∑—É–π—Ç–µ —Ä—ñ—Å—Ç –∞–±–æ —Å–ø–∞–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –ø–æ –¥–Ω—è—Ö, —Ç–∏–∂–Ω—è—Ö —ñ –º—ñ—Å—è—Ü—è—Ö.</p>
  </div>
  <div style="flex:1;min-width:280px;background:#fff;padding:20px;border-radius:16px;box-shadow:0 6px 16px rgba(0,0,0,0.05);">
    <h3>–ó–≤—ñ—Ç–∏ –≤ –æ–¥–∏–Ω –∫–ª—ñ–∫</h3>
    <p>–ï–∫—Å–ø–æ—Ä—Ç—É–π—Ç–µ –∞–Ω–∞–ª—ñ—Ç–∏–∫—É —É —Ñ–æ—Ä–º–∞—Ç—ñ CSV –∞–±–æ PDF –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É.</p>
  </div>
</section>
</main>

<footer>
  <p>¬© 2025 SyncOra. –í—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ.</p>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="lang.js"></script>
<script type="module" src="firebase-config.js"></script>
<script type="module" src="script.js"></script>
<script>
function generateReport() {
  const types = ['–©–æ—Ç–∏–∂–Ω–µ–≤–∏–π', '–©–æ–º—ñ—Å—è—á–Ω–∏–π', '–û—Å–æ–±–∏—Å—Ç–∏–π'];
  const sample = {
    title: '–ó–≤—ñ—Ç #' + Math.floor(Math.random() * 1000),
    type: types[Math.floor(Math.random() * types.length)],
    text: '–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: ' + (60 + Math.floor(Math.random() * 40)) + '%',
    email: JSON.parse(localStorage.getItem('loggedInUser'))?.email
  };
  const reports = JSON.parse(localStorage.getItem('reports')) || [];
  reports.push(sample);
  localStorage.setItem('reports', JSON.stringify(reports));
  location.reload();
}

function exportData(format) {
  const data = JSON.parse(localStorage.getItem('reports')) || [];
  const user = JSON.parse(localStorage.getItem('loggedInUser'));
  const filtered = data.filter(r => r.email === user.email);
  const name = 'reports_' + user.email.replace(/[@.]/g, '_') + '.' + format;

  if (format === 'json') {
    const blob = new Blob([JSON.stringify(filtered, null, 2)], { type: 'application/json' });
    downloadBlob(blob, name);
  } else {
    const headers = Object.keys(filtered[0] || {});
    const rows = filtered.map(obj => headers.map(k => JSON.stringify(obj[k] || '')).join(','));
    const csv = [headers.join(','), ...rows].join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    downloadBlob(blob, name);
  }
}

function downloadBlob(blob, filename) {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
}

async function downloadReportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text("–ó–≤—ñ—Ç –ø–æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ", 20, 20);
  let y = 30;
  const data = JSON.parse(localStorage.getItem('reports')) || [];
  const user = JSON.parse(localStorage.getItem('loggedInUser'));
  const filtered = data.filter(r => r.email === user.email);
  filtered.forEach(r => {
    doc.text('‚Ä¢ ' + r.title + ' [' + r.type + ']', 20, y);
    y += 10;
    doc.text(r.text, 25, y);
    y += 10;
    if (y > 270) { doc.addPage(); y = 20; }
  });
  doc.save("performance-report.pdf");
}

document.addEventListener('DOMContentLoaded', () => {
  const container = document.getElementById('reportsContainer');
  const user = JSON.parse(localStorage.getItem('loggedInUser'));
  if (!user) window.location.href = 'login.html';

  const data = JSON.parse(localStorage.getItem('reports')) || [];
  const filtered = data.filter(r => r.email === user.email);
  container.innerHTML = '';
  filtered.forEach((r, i) => {
    const li = document.createElement('li');
    li.className = 'challenge-item';
    li.innerHTML = `<h3>${r.title}</h3><p><strong>–¢–∏–ø:</strong> ${r.type}</p><p>${r.text}</p>`;
    container.appendChild(li);
  });

  const ctx = document.getElementById('reportChart').getContext('2d');
  const counts = { '–©–æ—Ç–∏–∂–Ω–µ–≤–∏–π': 0, '–©–æ–º—ñ—Å—è—á–Ω–∏–π': 0, '–û—Å–æ–±–∏—Å—Ç–∏–π': 0 };
  filtered.forEach(r => counts[r.type]++);
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: Object.keys(counts),
      datasets: [{
        label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–≤—ñ—Ç—ñ–≤',
        data: Object.values(counts),
        backgroundColor: ['#007aff', '#00c853', '#ff6f00']
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
});
</script>
</body>
</html>